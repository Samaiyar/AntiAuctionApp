<div class="page-container">

    <!-- Category Management -->
    <div class="panel">
        <div class="panel-header">
            <div>
                <h2 class="panel-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                    </svg>
                    Category Management
                </h2>
                <p class="panel-subtitle">Manage player categories and base prices.</p>
            </div>
        </div>

        <!-- Category Table -->
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Category Name</th>
                        <th>Base Price</th>
                        <th>Timer (sec)</th>
                        <th class="th-actions">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let category of categories">
                        <td class="td-name">{{ category.name }}</td>
                        <td>{{ category.base_price | currency:'USD':'symbol':'1.0-0' }}</td>
                        <td>{{ category.timer || 10 }}s</td>
                        <td class="td-actions">
                            <button class="icon-btn delete-btn" (click)="deleteCategory(category.id!)"
                                title="Delete Category">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                </svg>
                            </button>
                        </td>
                    </tr>
                    <tr *ngIf="categories.length === 0">
                        <td colspan="4" class="empty-row">No categories added yet.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Add Category Form -->
        <div class="inline-form">
            <h3 class="form-section-title">Add New Category</h3>
            <form [formGroup]="categoryForm" (ngSubmit)="addCategory()" class="form-row">
                <input type="text" formControlName="name" placeholder="Category Name (e.g. Batsman)" class="form-input">
                <input type="number" formControlName="base_price" placeholder="Base Price (e.g. 50000)"
                    class="form-input">
                <input type="number" formControlName="timer" placeholder="Timer (sec)"
                    class="form-input form-input-small">
                <button type="submit" [disabled]="categoryForm.invalid || isSubmitting" class="btn-primary">
                    {{ isSubmitting ? 'Adding...' : 'Add Category' }}
                </button>
            </form>
        </div>
    </div>

    <!-- Team Management -->
    <div class="panel">
        <div class="panel-header">
            <div>
                <h2 class="panel-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Team Management
                </h2>
                <p class="panel-subtitle">Overview and management of all participating teams.</p>
            </div>
            <button class="btn-primary" (click)="openAddTeamModal()">+ Add Team</button>
        </div>

        <!-- Team Cards Grid -->
        <div class="team-grid">
            <div *ngFor="let team of teams" class="team-card">
                <button class="card-close-btn" (click)="deleteTeam(team.id!)" title="Delete Team">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
                <div class="team-card-body">
                    <div class="team-icon">
                        <img *ngIf="team.logo_url" [src]="team.logo_url" alt="Logo">
                        <span *ngIf="!team.logo_url">üèÜ</span>
                    </div>
                    <h3 class="team-name">{{ team.name }}</h3>
                    <p class="team-captain">Captain: <strong>{{ team.captain || 'Unassigned' }}</strong></p>

                    <div class="team-budget">
                        <div class="budget-row">
                            <span>Budget</span>
                            <span>{{ team.budget | currency:'USD':'symbol':'1.0-0' }}</span>
                        </div>
                        <div class="budget-bar">
                            <div class="budget-bar-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="teams.length === 0" class="empty-state">
            <p>No teams created yet.</p>
            <button class="link-btn" (click)="openAddTeamModal()">Create your first team</button>
        </div>
    </div>
</div>

<!-- Add Team Modal -->
<div *ngIf="showTeamModal" class="modal-overlay" (click)="closeAddTeamModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
        <h3 class="modal-title">Add New Team</h3>
        <form [formGroup]="teamForm" (ngSubmit)="addTeam()" class="modal-form">
            <!-- Logo Upload -->
            <div class="form-group logo-upload-group">
                <label>Team Logo</label>
                <div class="logo-upload-row">
                    <label class="logo-preview" for="logoUpload">
                        <img *ngIf="logoPreview" [src]="logoPreview" alt="Logo Preview">
                        <div *ngIf="!logoPreview" class="logo-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                <circle cx="8.5" cy="8.5" r="1.5" />
                                <polyline points="21 15 16 10 5 21" />
                            </svg>
                        </div>
                    </label>
                    <input type="file" id="logoUpload" class="hidden-input" (change)="onLogoSelected($event)"
                        accept="image/*">
                    <label for="logoUpload" class="upload-link">{{ logoPreview ? 'Change logo' : 'Upload logo'
                        }}</label>
                </div>
            </div>

            <div class="form-group">
                <label>Team Name</label>
                <input type="text" formControlName="name" placeholder="e.g. Warriors" class="form-input">
            </div>
            <div class="form-group">
                <label>Captain</label>
                <input type="text" formControlName="captain" placeholder="e.g. John Doe" class="form-input">
            </div>
            <div class="form-group">
                <label>Starting Budget</label>
                <input type="number" formControlName="budget" placeholder="e.g. 100000" class="form-input">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-cancel" (click)="closeAddTeamModal()">Cancel</button>
                <button type="submit" [disabled]="teamForm.invalid || isSubmitting" class="btn-primary">
                    {{ isSubmitting ? 'Creating...' : 'Create Team' }}
                </button>
            </div>
        </form>
    </div>
</div>